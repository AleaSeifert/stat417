<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STAT 417 Final Project Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="project_report_files/libs/clipboard/clipboard.min.js"></script>
<script src="project_report_files/libs/quarto-html/quarto.js"></script>
<script src="project_report_files/libs/quarto-html/popper.min.js"></script>
<script src="project_report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="project_report_files/libs/quarto-html/anchor.min.js"></script>
<link href="project_report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="project_report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="project_report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="project_report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="project_report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#main-report" id="toc-main-report" class="nav-link" data-scroll-target="#main-report">Main Report</a>
  <ul class="collapse">
  <li><a href="#mean-and-median-survival-times" id="toc-mean-and-median-survival-times" class="nav-link" data-scroll-target="#mean-and-median-survival-times">Mean and Median Survival Times</a></li>
  <li><a href="#parametric-survival-analysis" id="toc-parametric-survival-analysis" class="nav-link" data-scroll-target="#parametric-survival-analysis">Parametric Survival Analysis</a></li>
  <li><a href="#non-parametric-survival-analysis" id="toc-non-parametric-survival-analysis" class="nav-link" data-scroll-target="#non-parametric-survival-analysis">Non-Parametric Survival Analysis</a></li>
  <li><a href="#regression-analysis" id="toc-regression-analysis" class="nav-link" data-scroll-target="#regression-analysis">Regression Analysis</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#parametric-and-non-parametric-analyses" id="toc-parametric-and-non-parametric-analyses" class="nav-link" data-scroll-target="#parametric-and-non-parametric-analyses">Parametric and Non-Parametric Analyses</a></li>
  <li><a href="#regression-analysis-1" id="toc-regression-analysis-1" class="nav-link" data-scroll-target="#regression-analysis-1">Regression Analysis</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STAT 417 Final Project Report</h1>
<p class="subtitle lead">New York Times Mini Crossword Completion</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alea Seifert, Alie Hall, Jett Palmer, Libby Brill </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<!-- Provide a brief description of the data set you have selected, i.e. the variables, how the study
was conducted, and any other details you can provide. If you collected your own data, then describe how the data were collected and how (right) censoring could occur. Be sure to define the time-to-event variable and how right censoring could occur. -->
<section id="origin-of-data" class="level4">
<h4 class="anchored" data-anchor-id="origin-of-data">Origin of Data</h4>
<p>This data was student-collected by the members of this 417 project. We decided to collect data on the <a href="https://www.nytimes.com/crosswords/game/mini">New York Times Mini Crossword</a> completion, referred to as the Mini henceforth. We recorded the following data on 51 Cal Poly students: time to Mini completion in seconds (up to 300 seconds), whether the time was complete or not, number of squares that the Mini had to fill in, the participant’s self-identified gender, and student reaction time in milliseconds (according to the <a href="https://humanbenchmark.com/tests/reactiontime">Human Benchmark</a>).</p>
</section>
<section id="action-plan" class="level4">
<h4 class="anchored" data-anchor-id="action-plan">Action Plan</h4>
<p>This study analyzed the time-to-event variable T, representing the time (in seconds) from when a subject presses “start” to when the mini is complete. The mini has a built-in timer to track participants time that was used for this study. The study was conducted over the course of five days, with each day featuring a different Mini puzzle. Participants were Cal Poly students, and no duplicate individuals were included in the study.</p>
<p>During each session, students attempted to solve the Mini. If they successfully completed the puzzle within 300 seconds (five minutes), we recorded their total completion time. If the five minutes expiref before they won, their time was recorded as censored (300+ seconds). Additionally, if a student quit before 300 seconds without solving the puzzle, or turned on the autocheck feature, their time was marked as censored (incomplete time in seconds).</p>
<p>As an additional variable, we collected each participant’s reaction time using the Human Benchmark reaction time test. This was to see if there is any association between reaction time and Mini abilities. Our final data set includes the Mini completion time, whether the time was censored or not, the number of squares to be filled in, the participant’s self-identified gender, and the participant’s reaction time.</p>
</section>
<section id="variables" class="level4">
<h4 class="anchored" data-anchor-id="variables">Variables</h4>
<ul>
<li>time (quantitative)
<ul>
<li>time starts when the puzzle is opened, when the Mini clock begins counting</li>
<li>time is measured in seconds, converted from the Mini clock time (which is given in minutes and seconds)</li>
<li>time is censored at 300 seconds</li>
</ul></li>
<li>censor (indicator)
<ul>
<li>0: censored, 1: complete</li>
</ul></li>
<li>gender (categorical)
<ul>
<li>participant will self-identify</li>
</ul></li>
<li>reaction_time (quantitative)
<ul>
<li>measured in milliseconds, as given by the Human Benchmark reaction time test</li>
</ul></li>
<li>squares (quantitative)
<ul>
<li>the number of squares to be filled in</li>
<li>for example, the number of squares in the following puzzle would be recorded as 22: <img src="images/blank_mini.png" class="img-fluid"></li>
</ul></li>
</ul>
</section>
</section>
<section id="main-report" class="level1">
<h1>Main Report</h1>
<section id="mean-and-median-survival-times" class="level3">
<h3 class="anchored" data-anchor-id="mean-and-median-survival-times">Mean and Median Survival Times</h3>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Overall</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Mean (sec)</th>
<th style="text-align: right;">Median (sec)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">194.84</td>
<td style="text-align: right;">182</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>By Gender</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Mean (sec)</th>
<th style="text-align: right;">Median (sec)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Female</td>
<td style="text-align: right;">192.19</td>
<td style="text-align: right;">182.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Male</td>
<td style="text-align: right;">200.31</td>
<td style="text-align: right;">234.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Non-Binary/Other</td>
<td style="text-align: right;">193.50</td>
<td style="text-align: right;">195.0</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>By Number of Squares</caption>
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: right;">Mean (sec)</th>
<th style="text-align: right;">Median (sec)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">173.29</td>
<td style="text-align: right;">136.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">21</td>
<td style="text-align: right;">226.73</td>
<td style="text-align: right;">300.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22</td>
<td style="text-align: right;">181.85</td>
<td style="text-align: right;">172.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: right;">220.00</td>
<td style="text-align: right;">236.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="parametric-survival-analysis" class="level3">
<h3 class="anchored" data-anchor-id="parametric-survival-analysis">Parametric Survival Analysis</h3>
<!-- Through approaches we have discussed in the class, find a probability distribution that best fits your time-to-event data. Explain why the particular distribution was chosen. Once you have determined a probability distribution, construct the survival function and hazard function for all individuals in the data set and describe your observations. In addition, examine the survival and hazard functions for different groups of interest and report what you observe. Finally, report the mean and median survival times for all individuals and for the various groups you have examined. -->
<p>Log-logistic</p>
<section id="survival-plots" class="level4">
<h4 class="anchored" data-anchor-id="survival-plots">Survival Plots</h4>
<p><img src="images/loglogistic_survival.png" class="img-fluid"></p>
<p>The probability that a student has not completed the puzzle after time t, in seconds, decreases rapidly, then begins to plateau around 500 seconds.</p>
<p><img src="images/loglogistic_survival_gender.png" class="img-fluid"></p>
<p>When we compare completion times based on the gender of the student, we observe similar survival curves for female and non-binary students. It appears that the probability that a male student has not completed the puzzle after time t is greater than the probability for female and non-binary students, for all time.</p>
<p><img src="images/loglogistic_survival_squares.png" class="img-fluid"></p>
<p>We also compared survival times based on the number of playable squares and found that the probability subjects do not complete puzzles with 19 squares beyond time t is lowest, as compared to puzzles with more playable squares (21, 22, 40).</p>
</section>
<section id="hazard-plots" class="level4">
<h4 class="anchored" data-anchor-id="hazard-plots">Hazard Plots</h4>
<p><img src="images/loglogistic_hazard.png" class="img-fluid"></p>
<p>The potential of completing the puzzle increases rapidly until roughly 200 seconds. After 200 seconds, the longer the student doesn’t complete the puzzle, the lower the potential of completing the puzzle.</p>
<p><img src="images/loglogistic_hazard_gender.png" class="img-fluid"></p>
<p>Before roughly 200 seconds, the potential of completing the puzzle is lowest for male students and highest for non-binary students. After 200 seconds, the potential to complete the puzzle is roughly the same for female and non-binary students and remains lower for male students, for remaining time t.</p>
<p><img src="images/loglogistic_hazard_squares.png" class="img-fluid"></p>
<p>For all time t, the potential to complete the puzzle with 19 playable squares is notably higher than the potential to complete the puzzle for other size puzzles (21, 22, 40 squares).</p>
</section>
</section>
<section id="non-parametric-survival-analysis" class="level3">
<h3 class="anchored" data-anchor-id="non-parametric-survival-analysis">Non-Parametric Survival Analysis</h3>
<!-- Use non-parametric methods to describe and compare survival experiences of the different groups in your data set. Examine and comment on the survival experience of all individuals in your data set, as well as the survival experiences of different groups of individuals. Use graphical displays such as Kaplan-Meier curves, and/or estimated hazard curves, and perform and report results of the log-rank test. In addition, compute various descriptive statistics of interest. Finally, compare some of your findings using the non-parametric approaches to your findings using the parametric approaches. -->
<section id="survival-plots-1" class="level4">
<h4 class="anchored" data-anchor-id="survival-plots-1">Survival Plots</h4>
<p><img src="images/nonparametric_survival.png" class="img-fluid"></p>
<p>We estimate about 35% of students do not complete the puzzle by the end of the study. The estimated probability of not completing the puzzle beyond time t, in seconds, decreases steadily for all time.</p>
<p><img src="images/nonparametric_survival_gender.png" class="img-fluid"></p>
<p>The estimated probability of not completing the puzzle by the end of the study appears to be similar across genders for all time. However, it appears that the probability of not completing the puzzle for female students is higher for most times prior to 175 seconds, then drops below male and non-binary students after 175 seconds.</p>
<p><img src="images/nonparametric_survival_squares.png" class="img-fluid"></p>
<p>The estimated probability that students do not solve puzzles with 22 playable squares beyond time t is lowest for most times, in seconds, with the exception of 175 to 200 seconds and briefly around 60 seconds. For most times, the estimated probability a student does not solve puzzles with 40 playable squares is highest, especially compared to puzzles with 22 squares.</p>
</section>
<section id="hazard-plots-1" class="level4">
<h4 class="anchored" data-anchor-id="hazard-plots-1">Hazard Plots</h4>
<p><img src="images/nonparametric_hazard.png" class="img-fluid"></p>
<p>The estimated risk of completing the puzzle rapidly increases during the first 20 seconds. From there, the estimated hazard is roughly constant until 60 seconds, then steadily increases for the remainder of the study.</p>
<p><img src="images/nonparametric_hazard_gender.png" class="img-fluid"></p>
<p>The estimated risk of completing the puzzle is lowest for female students across all time, t. While male students exhibit slightly higher potential for puzzle completion than females, we observe a similar trend between these two groups. A much sharper increase in potential to complete the puzzle for non-binary students occurs around 80 seconds.</p>
<p><img src="images/nonparametric_hazard_squares.png" class="img-fluid"></p>
<p>Over all time, the estimated potential to complete puzzles with 19 playable squares becomes notably larger than that of the larger sized puzzles (21, 22, and 40 squares). After 150 seconds, we observe the estimated risk of completion for 21 and 22 square puzzles increase slightly, but 21 and 19 square puzzles increase more rapidly.</p>
</section>
<section id="log-rank-test" class="level4">
<h4 class="anchored" data-anchor-id="log-rank-test">Log-Rank Test</h4>
<section id="gender" class="level5">
<h5 class="anchored" data-anchor-id="gender">Gender</h5>
<p><img src="images/logrank_gender.png" class="img-fluid"></p>
<p>Since the p-value 0.883 is larger than any reasonable level of significance, we have insufficient evidence to conclude that the probability of puzzle incompletion differs across male, female, and non-binary students for some time, t. This indicates a failure to reject the null hypothesis of the log-rank test.</p>
</section>
<section id="squares" class="level5">
<h5 class="anchored" data-anchor-id="squares">Squares</h5>
<p><img src="images/logrank_squares.png" class="img-fluid"></p>
<p>Similarly, since the p-value 0.482 is larger than any reasonable level of significance, we have insufficient evidence to conclude that the probability of puzzle incompletion differs across puzzles with 19, 21, 22, or 40 playable squares. This indicates a failure to reject the null hypothesis of the log-rank test.</p>
</section>
</section>
</section>
<section id="regression-analysis" class="level3">
<h3 class="anchored" data-anchor-id="regression-analysis">Regression Analysis</h3>
<!-- Develop a Cox regression model to investigate the associations of the predictors (explanatory variables) with the hazard rate. You need only present your final model, including, but not limited to, parameter estimates, standard errors, and p-values. Discuss whether model assumptions have been met and whether you removed any influential or outlying cases. Be sure to present the residual diagnostic plots to support your discussion. Then for some key values of the predictors, present estimated hazard ratios and confidence intervals for the corresponding true hazard ratio. Provide interpretations of the hazard ratios -->
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<!-- Summarize and discuss any insightful discoveries about the time-to-event data and your most important findings. -->
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<!-- Include all R code used to conduct your analyses in the Appendix at the end of the report. -->
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p><strong>ADD DATA TABLE</strong></p>
</section>
<section id="parametric-and-non-parametric-analyses" class="level3">
<h3 class="anchored" data-anchor-id="parametric-and-non-parametric-analyses">Parametric and Non-Parametric Analyses</h3>
<section id="summary-tables" class="level5">
<h5 class="anchored" data-anchor-id="summary-tables">Summary Tables</h5>
<p><strong>ADD TABLE CODE</strong></p>
</section>
<section id="graphs-and-tests" class="level5">
<h5 class="anchored" data-anchor-id="graphs-and-tests">Graphs and Tests</h5>
<p>The graphs and tests for parametric and non-parametric analyses were conducted in Minitab.</p>
</section>
</section>
<section id="regression-analysis-1" class="level3">
<h3 class="anchored" data-anchor-id="regression-analysis-1">Regression Analysis</h3>
<p><strong>ADD REGRESSION CODE</strong></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>